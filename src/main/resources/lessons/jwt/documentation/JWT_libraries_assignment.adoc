import io.jsonwebtoken.Claims;
import io.jsonwebtoken.Jws;
import io.jsonwebtoken.JwtException;
import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.SignatureAlgorithm;
import io.jsonwebtoken.security.Keys;

import java.security.Key;
import javax.crypto.spec.SecretKeySpec;
import java.util.Base64;
import java.util.Date;

// ... other imports and class definition

try {
    // Dynamically generate a secure key. In a real-world application, you would store this key securely.
    // For example, you could use a secure vault service or environment variables that are not hard-coded in the source code.
    String secretString = System.getenv("JWT_SECRET"); // Use an environment variable or other secure source
    if (secretString == null || secretString.trim().isEmpty()) {
        throw new IllegalStateException("Secret key for JWT not configured properly.");
    }
    byte[] decodedKey = Base64.getDecoder().decode(secretString);
    Key key = new SecretKeySpec(decodedKey, 0, decodedKey.length, "AES");

    Jws<Claims> jwsClaims = Jwts.parserBuilder()
        .setSigningKey(key)
        .build()
        .parseClaimsJws(accessToken);

    Claims claims = jwsClaims.getBody();
    String user = claims.get("user", String.class);
    boolean isAdmin = claims.get("admin", Boolean.class);

    if (isAdmin) {
        removeAllUsers();
    } else {
        log.error("You are not an admin user");
    }
} catch (JwtException e) {
    throw new InvalidTokenException(e);
}
